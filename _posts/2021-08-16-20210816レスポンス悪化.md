---
title: 2021/08/15 レスポンス悪化
categories: 障害
date: 2021-08-16
---
## 発生時刻
2021/08/15 08:40頃〜

## 現象
[キュア！](/articles/キュア！/)投稿が反映するまで時間がかかっていました。
数秒から、酷い場合には数十秒。

## 原因
お恥ずかしながら、詳細不明。

外部APIからのレスポンスの悪化は確認できました。但し特定のサービスではなく、複数のサービスにまたがって特に規則性もなく現象が発生していました。
例えば過去には、こうした外部サービスのひとつであるSpotifyの障害によりキュアスタ！全体のレスポンスが悪くなったことがありました。（設計の見直しにより、この障害には対策済み）この時のような、単に「Spotifyが悪い」というわかりやすい問題ではなかったです。
また、APIのレスポンス悪化はMastodon内部で起きていた問題に由来した二次的なもので、根本原因ではなかった様にも感じます。

## 対応
以下の理由から、[さくらのVPS](https://vps.sakura.ad.jp/)から[Vultr](https://www.vultr.com/products/cloud-compute/)に移行しました。

- [さくらのVPS](https://vps.sakura.ad.jp/)にある[美食丼](https://mstdn.b-shock.org)でも、同様の現象が同時に発生していました。一方、[Vultr](https://www.vultr.com/products/cloud-compute/)に構築された[デルムリン丼](https://mstdn.delmulin.com/)では問題が起きていませんでした。この状況から「何かはわからないが、さくらインターネットで問題が起きている」という切り分けを行いました。
- 発生日は日曜日で、さくらインターネットの営業日ではありませんでした。キュアスタ！としては、障害対応を翌日まで持ち越せる状況ではなかったです。

キュアスタ！のMastodon本体は、移転の為に15:15頃に一旦停止。17:30頃に[Vultr](https://www.vultr.com/products/cloud-compute/)の新しいVPSで復旧しました。
